<!DOCTYPE html><html lang="en"><head><title>thinkspace-indented-list/addon/mixins/item/change</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../../"><meta name="groc-document-path" content="thinkspace-indented-list/addon/mixins/item/change"><meta name="groc-project-path" content="thinkspace-indented-list/addon/mixins/item/change.coffee"><meta name="groc-branch-path" content="feature/pe-builder-comments"><meta name="groc-github-url" content="https://github.com/sixthedge/ethinkspace-client"><link rel="stylesheet" type="text/css" media="all" href="../../../../assets/style.css"><script type="text/javascript" src="../../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/sixthedge/ethinkspace-client/blob/feature/pe-builder-comments/thinkspace-indented-list/addon/mixins/item/change.coffee">thinkspace-indented-list/addon/mixins/item/change.coffee</a></div></div><div id="document"><a href="/" class="lodestar-link">Back to Guides</a><div class="segment"><div class="code"><div class="wrapper">import ember  from <span class="hljs-string">'ember'</span>

export default ember.Mixin.create

  <span class="hljs-attribute">change_item_pos_x</span>: <span class="hljs-function"><span class="hljs-params">(items, delta_x)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> ember.isBlank(items)
    ember.makeArray(items).forEach (item) =&gt;
      pos_x = item.pos_x + delta_x
      <span class="hljs-property">@set_item_pos_x</span>(item, pos_x)
      <span class="hljs-property">@reset_item_component_indent</span>(item)

  <span class="hljs-attribute">change_item_position</span>: <span class="hljs-function"><span class="hljs-params">(item, to_index, options={})</span> -&gt;</span>
    <span class="hljs-keyword">new</span> ember.RSVP.Promise (resolve, reject) =&gt;
      <span class="hljs-keyword">return</span> resolve() <span class="hljs-keyword">if</span> ember.isBlank(to_index)
      children  = <span class="hljs-property">@get_item_change_position_children</span>(item)
      index     = <span class="hljs-property">@value_items</span>.indexOf(item)
      num_items = children.length + <span class="hljs-number">1</span>
      new_index = <span class="hljs-keyword">if</span> index &lt; to_index <span class="hljs-keyword">then</span> (to_index - num_items) <span class="hljs-keyword">else</span> to_index
      map       = <span class="hljs-property">@new_options_item_property_map</span>(options)
      <span class="hljs-property">@populate_item_component_property_map</span>(item, map)
      <span class="hljs-property">@populate_item_component_property_map</span>(children, map)
      <span class="hljs-property">@value_items</span>.removeAt(index, num_items)
      options.children = children
      <span class="hljs-property">@change_item_position_items</span>(item, new_index, options).<span class="hljs-keyword">then</span> =&gt;
        resolve()

  <span class="hljs-attribute">change_item_position_items</span>: <span class="hljs-function"><span class="hljs-params">(item, index, options={})</span> -&gt;</span>
    <span class="hljs-keyword">new</span> ember.RSVP.Promise (resolve, reject) =&gt;
      children = options.children <span class="hljs-keyword">or</span> []
      pos_x    = options.pos_x
      <span class="hljs-keyword">if</span> ember.isPresent(pos_x)
        delta_x = pos_x - item.pos_x
        <span class="hljs-property">@set_item_pos_x</span>(item, pos_x)
      <span class="hljs-property">@value_items</span>.insertAt(index, item)
      children.forEach (child_item) =&gt;
        index            += <span class="hljs-number">1</span>
        child_item.pos_x += delta_x  <span class="hljs-keyword">if</span> ember.isPresent(delta_x)
        <span class="hljs-property">@value_items</span>.insertAt(index, child_item)
      ember.run.schedule <span class="hljs-string">'afterRender'</span>, @, <span class="hljs-function">=&gt;</span>
        <span class="hljs-property">@restore_item_component_properties</span>(options)
        <span class="hljs-property">@select_item</span>(item)
        resolve()

  <span class="hljs-attribute">get_change_item_index_from_sibling_element</span>: <span class="hljs-function"><span class="hljs-params">(sibling)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-property">@get_value_items_bottom_index</span>() <span class="hljs-keyword">if</span> ember.isBlank(sibling)
    <span class="hljs-property">@get_change_item_index_from_sibling_item</span> <span class="hljs-property">@get_visible_item</span>($(sibling))

  <span class="hljs-attribute">get_change_item_index_from_sibling_item</span>: <span class="hljs-function"><span class="hljs-params">(sibling_item)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-property">@get_value_items_bottom_index</span>() <span class="hljs-keyword">unless</span> (sibling_item <span class="hljs-keyword">and</span> ember.isPresent(sibling_item))
    <span class="hljs-property">@value_items</span>.indexOf(sibling_item)

  <span class="hljs-attribute">get_item_change_position_children</span>: <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-property">@include_item_children_on_change</span>(item) <span class="hljs-keyword">then</span> <span class="hljs-property">@get_item_children</span>(item, <span class="hljs-literal">false</span>) <span class="hljs-keyword">else</span> []

  <span class="hljs-attribute">get_visible_item</span>: <span class="hljs-function"><span class="hljs-params">($el)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-property">@get_element_item</span>($el)  <span class="hljs-keyword">if</span> <span class="hljs-property">@is_element_visible</span>($el)
    $next = <span class="hljs-property">@get_visible_next</span>($el)
    ember.isPresent($next) <span class="hljs-keyword">and</span> <span class="hljs-property">@get_element_item</span>($next)

  <span class="hljs-attribute">include_item_children_on_change</span>: <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span> <span class="hljs-property">@has_item_children</span>(item) <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-property">@are_item_children_visible</span>(item)

  <span class="hljs-attribute">is_element_visible</span>: <span class="hljs-function"><span class="hljs-params">($el)</span>         -&gt;</span> <span class="hljs-property">@is_item_visible</span> <span class="hljs-property">@get_element_item</span>($el)
  <span class="hljs-attribute">is_item_visible</span>:   <span class="hljs-function"><span class="hljs-params">(item)</span>         -&gt;</span> item <span class="hljs-keyword">and</span> <span class="hljs-property">@get_item_component</span>(item).get(<span class="hljs-string">'item_visible'</span>)
  <span class="hljs-attribute">are_item_children_visible</span>: <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span> <span class="hljs-property">@get_item_component</span>(item).get(<span class="hljs-string">'children_visible'</span>)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="">#</h2>
<h3 id="populaterestore-item-component-properties">Populate/Restore Item Component Properties.</h3>
<h2 id="">#</h2></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">map_component_properties</span>: [<span class="hljs-string">'item_visible'</span>, <span class="hljs-string">'children_visible'</span>, <span class="hljs-string">'is_selected'</span>, <span class="hljs-string">'overflow_visible'</span>]

  <span class="hljs-attribute">new_options_item_property_map</span>: <span class="hljs-function"><span class="hljs-params">(options)</span> -&gt;</span> options.item_property_map = ember.Map.create()

  <span class="hljs-attribute">populate_item_component_property_map</span>: <span class="hljs-function"><span class="hljs-params">(items, map)</span> -&gt;</span>
    ember.makeArray(items).forEach (item) =&gt;
      map.set item, <span class="hljs-property">@get_item_component_properties</span>(item)

  <span class="hljs-attribute">restore_item_component_properties</span>: <span class="hljs-function"><span class="hljs-params">(options)</span> -&gt;</span>
    map = options.item_property_map
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> ember.isBlank(map)
    map.forEach (props, item) =&gt; <span class="hljs-property">@set_item_component_properties</span>(item, props)

  <span class="hljs-attribute">get_item_component_properties</span>: <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span>
    props = <span class="hljs-property">@map_component_properties</span> <span class="hljs-keyword">or</span> []
    comp  = <span class="hljs-property">@get_item_component</span>(item)
    comp.getProperties(props...)

  <span class="hljs-attribute">set_item_component_properties</span>: <span class="hljs-function"><span class="hljs-params">(item, props)</span> -&gt;</span>
    comp = <span class="hljs-property">@get_item_component</span>(item)
    comp.setProperties(props)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="">#</h2>
<h3 id="reset-component">Reset Component.</h3>
<h2 id="">#</h2></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">reset_item_component_indent</span>: <span class="hljs-function"><span class="hljs-params">(items)</span> -&gt;</span>
    ember.makeArray(items).forEach (item) =&gt;
      comp = <span class="hljs-property">@get_item_component</span>(item)
      comp.set_indent()

  <span class="hljs-attribute">reset_has_children</span>: <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span>
    ember.run.schedule <span class="hljs-string">'afterRender'</span>, @, <span class="hljs-function">=&gt;</span>
      <span class="hljs-property">@reset_prev_item_component_has_children</span>(item)
      <span class="hljs-property">@reset_next_item_component_has_children</span>(item)
      <span class="hljs-property">@reset_item_component_has_children</span>(item)
      <span class="hljs-property">@reset_number_of_children</span>(item)

  <span class="hljs-attribute">reset_prev_parent_item_component_has_children</span>: <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span>
    prev_item = <span class="hljs-property">@get_prev_item</span>(item)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">unless</span> prev_item
    prev_parent_item = <span class="hljs-property">@get_item_parent</span>(prev_item)
    <span class="hljs-keyword">if</span> prev_parent_item
      items = <span class="hljs-property">@get_item_children</span>(prev_parent_item)
      items.push(prev_parent_item)
      <span class="hljs-property">@reset_item_component_has_children</span>(items)
    <span class="hljs-keyword">else</span>
      <span class="hljs-property">@reset_item_component_has_children</span>(prev_item)

  <span class="hljs-attribute">reset_prev_item_component_has_children</span>: <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span>
    prev_item = <span class="hljs-property">@get_prev_item</span>(item)
    <span class="hljs-property">@reset_item_component_has_children</span>(prev_item)  <span class="hljs-keyword">if</span> prev_item

  <span class="hljs-attribute">reset_next_item_component_has_children</span>: <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span>
    next_item = <span class="hljs-property">@get_next_item</span>(item)
    <span class="hljs-property">@reset_item_component_has_children</span>(next_item)  <span class="hljs-keyword">if</span> next_item

  <span class="hljs-attribute">reset_item_component_has_children</span>: <span class="hljs-function"><span class="hljs-params">(items)</span> -&gt;</span>
    ember.makeArray(items).forEach (item) =&gt;
      comp = <span class="hljs-property">@get_item_component</span>(item)
      comp.set_has_children()

  <span class="hljs-attribute">reset_number_of_children</span>: <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span>
    comp = <span class="hljs-property">@get_item_component</span>(item)
    comp.set_number_of_children()</div></div></div></div></body></html>
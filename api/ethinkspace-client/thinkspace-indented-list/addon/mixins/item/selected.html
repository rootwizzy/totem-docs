<!DOCTYPE html><html lang="en"><head><title>thinkspace-indented-list/addon/mixins/item/selected</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../../"><meta name="groc-document-path" content="thinkspace-indented-list/addon/mixins/item/selected"><meta name="groc-project-path" content="thinkspace-indented-list/addon/mixins/item/selected.coffee"><meta name="groc-branch-path" content="feature/rap-analytics-styling"><meta name="groc-github-url" content="https://github.com/sixthedge/ethinkspace-client"><link rel="stylesheet" type="text/css" media="all" href="../../../../assets/style.css"><script type="text/javascript" src="../../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/sixthedge/ethinkspace-client/blob/feature/rap-analytics-styling/thinkspace-indented-list/addon/mixins/item/selected.coffee">thinkspace-indented-list/addon/mixins/item/selected.coffee</a></div></div><div id="document"><a href="/" class="lodestar-link">Back to Guides</a><div class="segment"><div class="code"><div class="wrapper">import ember  from <span class="hljs-string">'ember'</span>

export default ember.Mixin.create

  <span class="hljs-attribute">select_item</span>: <span class="hljs-function"><span class="hljs-params">(item, options={})</span> -&gt;</span>
    ember.run.schedule <span class="hljs-string">'afterRender'</span>, @, <span class="hljs-function">=&gt;</span>
      comp = <span class="hljs-property">@get_item_component</span>(item)
      $el  = <span class="hljs-property">@get_item_element</span>(item)
      comp.set <span class="hljs-string">'is_selected'</span>, <span class="hljs-literal">true</span>
      <span class="hljs-property">@focus_element</span>($el) <span class="hljs-keyword">unless</span> options.skip_focus

  <span class="hljs-attribute">focus_element</span>: <span class="hljs-function"><span class="hljs-params">($el)</span> -&gt;</span>
    $el.focus()</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="">#</h2>
<h3 id="insert-beforeafter">Insert Before/After.</h3>
<h2 id="">#</h2>
<h3 id="insert-only-adds-a-39single39-item-beforeafter-the-selected-item-eg-vs-duplicate">Insert only adds a &#39;single&#39; item before/after the selected item (e.g. vs duplicate).</h3></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">insert_before</span>: <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span> <span class="hljs-property">@process_insert_before_after</span>(item, <span class="hljs-number">0</span>)
  <span class="hljs-attribute">insert_after</span>:  <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span> <span class="hljs-property">@process_insert_before_after</span>(item, <span class="hljs-number">1</span>)

  <span class="hljs-attribute">process_insert_before_after</span>: <span class="hljs-function"><span class="hljs-params">(item, n)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@readonly</span>
    new_item     = {<span class="hljs-attribute">pos_x</span>: item.pos_x}
    index        = <span class="hljs-property">@value_items</span>.indexOf(item)
    bottom       = <span class="hljs-property">@get_value_items_bottom_index</span>()
    insert_index = index + n
    insert_index = <span class="hljs-number">0</span>                                <span class="hljs-keyword">if</span> index &lt; <span class="hljs-number">0</span>
    insert_index = <span class="hljs-property">@get_value_items_bottom_index</span>()  <span class="hljs-keyword">if</span> index &gt; bottom
    <span class="hljs-property">@value_items</span>.insertAt(insert_index, new_item)
    <span class="hljs-property">@reset_has_children</span>(new_item)
    <span class="hljs-property">@select_item</span>(new_item)
    <span class="hljs-property">@save_response</span>()</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="">#</h2>
<h3 id="move-left-right">Move Left-Right.</h3>
<h2 id="">#</h2></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">move_left</span>:  <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span> <span class="hljs-property">@process_move_left_right</span>(item, -<span class="hljs-number">1</span>)
  <span class="hljs-attribute">move_right</span>: <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span> <span class="hljs-property">@process_move_left_right</span>(item, +<span class="hljs-number">1</span>)

  <span class="hljs-attribute">process_move_left_right</span>: <span class="hljs-function"><span class="hljs-params">(item, n, min=<span class="hljs-number">0</span>, max=<span class="hljs-property">@max_indent</span>)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@readonly</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> ember.isBlank(item)
    pos_x = item.pos_x
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> ember.isBlank(pos_x)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> pos_x &lt;= min
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> n &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> pos_x &gt;= max
    items = <span class="hljs-property">@get_item_change_position_children</span>(item)
    items.push(item)
    <span class="hljs-property">@change_item_pos_x</span>(items, n)
    <span class="hljs-property">@reset_has_children</span>(item)
    <span class="hljs-property">@save_response</span>()</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="">#</h2>
<h3 id="move-up-down">Move Up-Down.</h3>
<h2 id="">#</h2></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">move_up</span>:   <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span> <span class="hljs-property">@process_move_up</span>(item)
  <span class="hljs-attribute">move_down</span>: <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span> <span class="hljs-property">@process_move_down</span>(item)

  <span class="hljs-attribute">process_move_up</span>: <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@readonly</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> ember.isBlank(item)
    $el = <span class="hljs-property">@get_item_element</span>(item)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> ember.isBlank($el)
    $sibling = <span class="hljs-property">@get_visible_prev</span>($el)
    index    = <span class="hljs-property">@get_change_item_index_from_sibling_element</span>($sibling)
    bottom   = <span class="hljs-property">@get_value_items_bottom_index</span>()
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> index == bottom  <span class="hljs-comment"># already at top</span>
    <span class="hljs-property">@change_item_position</span>(item, index).<span class="hljs-keyword">then</span> =&gt;
      <span class="hljs-property">@reset_has_children</span>(item)
      <span class="hljs-property">@reset_prev_parent_item_component_has_children</span>(item)
      <span class="hljs-property">@reset_next_item_component_has_children</span>(item)
      <span class="hljs-property">@save_response</span>()

  <span class="hljs-attribute">process_move_down</span>: <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@readonly</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> ember.isBlank(item)
    $el = <span class="hljs-property">@get_item_element</span>(item)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> ember.isBlank($el)
    $next    = <span class="hljs-property">@get_visible_next</span>($el)
    $sibling = <span class="hljs-property">@get_visible_next</span>($next)
    index  = <span class="hljs-property">@get_change_item_index_from_sibling_element</span>($sibling)
    bottom = <span class="hljs-property">@get_value_items_bottom_index</span>()
    $next_visible = <span class="hljs-property">@get_visible_next</span>($el)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> ember.isBlank($next_visible) <span class="hljs-keyword">and</span> index == bottom  <span class="hljs-comment"># already at bottom</span>
    <span class="hljs-property">@change_item_position</span>(item, index).<span class="hljs-keyword">then</span> =&gt;
      <span class="hljs-property">@reset_has_children</span>(item)
      <span class="hljs-property">@reset_prev_parent_item_component_has_children</span>(item)
      <span class="hljs-property">@reset_next_item_component_has_children</span>(item)
      <span class="hljs-property">@save_response</span>()</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="">#</h2>
<h3 id="duplicate">Duplicate.</h3>
<h2 id="">#</h2></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">duplicate_before</span>: <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span> <span class="hljs-property">@process_duplicate_before_after</span>(item)
  <span class="hljs-attribute">duplicate_after</span>:  <span class="hljs-function"><span class="hljs-params">(item)</span> -&gt;</span> <span class="hljs-property">@process_duplicate_before_after</span>(item, <span class="hljs-literal">false</span>)

  <span class="hljs-attribute">process_duplicate_before_after</span>: <span class="hljs-function"><span class="hljs-params">(item, before=<span class="hljs-literal">true</span>)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@readonly</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> ember.isBlank(item)
    $el = <span class="hljs-property">@get_item_element</span>(item)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> ember.isBlank($el)
    $sibling  = <span class="hljs-keyword">if</span> before <span class="hljs-keyword">then</span> $el <span class="hljs-keyword">else</span> <span class="hljs-property">@get_visible_next</span>($el)
    dup_index = <span class="hljs-property">@get_change_item_index_from_sibling_element</span>($sibling)
    dup_item  = ember.merge({}, item)
    options   = <span class="hljs-property">@get_item_duplicate_options</span>(item, dup_item)
    <span class="hljs-property">@change_item_position_items</span>(dup_item, dup_index, options).<span class="hljs-keyword">then</span> =&gt;
      <span class="hljs-property">@reset_has_children</span>(dup_item)
      <span class="hljs-property">@select_item</span>(dup_item)
      <span class="hljs-property">@save_response</span>()

  <span class="hljs-attribute">get_item_duplicate_options</span>: <span class="hljs-function"><span class="hljs-params">(item, dup_item)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@readonly</span>
    options = {}
    map     = <span class="hljs-property">@new_options_item_property_map</span>(options)
    map.set dup_item, <span class="hljs-property">@get_item_component_properties</span>(item)
    dup_children = []
    <span class="hljs-property">@get_item_change_position_children</span>(item).forEach (child_item) =&gt;
      dup_child = ember.merge({}, child_item)
      dup_children.push(dup_child)
      map.set dup_child, <span class="hljs-property">@get_item_component_properties</span>(child_item)
    options.children = dup_children
    options</div></div></div></div></body></html>
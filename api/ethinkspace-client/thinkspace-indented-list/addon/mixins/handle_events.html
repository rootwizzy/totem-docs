<!DOCTYPE html><html lang="en"><head><title>thinkspace-indented-list/addon/mixins/handle_events</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../"><meta name="groc-document-path" content="thinkspace-indented-list/addon/mixins/handle_events"><meta name="groc-project-path" content="thinkspace-indented-list/addon/mixins/handle_events.coffee"><meta name="groc-branch-path" content="feature/pe-builder-comments"><meta name="groc-github-url" content="https://github.com/sixthedge/ethinkspace-client"><link rel="stylesheet" type="text/css" media="all" href="/assets/style.css"><script type="text/javascript" src="/assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/sixthedge/ethinkspace-client/blob/feature/pe-builder-comments/thinkspace-indented-list/addon/mixins/handle_events.coffee">thinkspace-indented-list/addon/mixins/handle_events.coffee</a></div></div><div id="document"><a href="/" class="lodestar-link">Back to Guides</a><div class="segment"><div class="code"><div class="wrapper">import ember  from <span class="hljs-string">'ember'</span>

export default ember.Mixin.create

  <span class="hljs-attribute">handle_cancel</span>: <span class="hljs-function"><span class="hljs-params">(clone, el, container, source)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">unless</span> <span class="hljs-property">@list_container</span> == container
    $el     = $(el)
    pos_x   = <span class="hljs-property">@get_element_pos_x</span>($(clone))
    item    = <span class="hljs-property">@get_element_item</span>($el)
    delta_x = pos_x - item.pos_x
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> delta_x == <span class="hljs-number">0</span>
    children  = <span class="hljs-property">@get_item_change_position_children</span>(item)
    <span class="hljs-property">@change_item_pos_x</span>(item, delta_x)
    <span class="hljs-property">@change_item_pos_x</span>(children, delta_x)
    <span class="hljs-property">@reset_has_children</span>(item)
    <span class="hljs-property">@save_response</span>()

  <span class="hljs-attribute">handle_drop</span>: <span class="hljs-function"><span class="hljs-params">(clone, el, target, source, sibling)</span> -&gt;</span>
    sibling = <span class="hljs-property">@get_sibling</span>(sibling)
    pos_x   = <span class="hljs-property">@get_element_pos_x</span>($(clone))
    index   = <span class="hljs-property">@get_change_item_index_from_sibling_element</span>(sibling)
    <span class="hljs-keyword">if</span> <span class="hljs-property">@list_container</span> == source
      <span class="hljs-property">@drop_move_item</span>(pos_x, el, index)
    <span class="hljs-keyword">else</span>
      <span class="hljs-property">@drop_new_item</span>(pos_x, el, source, index)

  <span class="hljs-attribute">drop_move_item</span>: <span class="hljs-function"><span class="hljs-params">(pos_x, el, index)</span> -&gt;</span>
    $el  = $(el)
    item = <span class="hljs-property">@get_element_item</span>($el)
    <span class="hljs-property">@change_item_position</span>(item, index, <span class="hljs-attribute">pos_x</span>: pos_x).<span class="hljs-keyword">then</span> =&gt;
      $el.remove()
      <span class="hljs-property">@reset_has_children</span>(item)
      <span class="hljs-property">@save_response</span>()

  <span class="hljs-attribute">drop_new_item</span>: <span class="hljs-function"><span class="hljs-params">(pos_x, el, source, index)</span> -&gt;</span>
    $el = $(el)
    <span class="hljs-property">@get_new_item</span>($el, pos_x, source).<span class="hljs-keyword">then</span> (new_item) =&gt;
      $el.remove()
      <span class="hljs-property">@value_items</span>.insertAt(index, new_item)
      <span class="hljs-property">@reset_has_children</span>(new_item)
      <span class="hljs-property">@select_item</span>(new_item)
      <span class="hljs-property">@save_response</span>()

  <span class="hljs-attribute">get_element_pos_x</span>: <span class="hljs-function"><span class="hljs-params">($el)</span> -&gt;</span>
    cleft = $(<span class="hljs-property">@list_container</span>).offset().left
    eleft = $el.offset().left <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>
    left  = eleft - cleft
    <span class="hljs-keyword">if</span> (left <span class="hljs-keyword">and</span> left &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">then</span> pos_x = Math.floor(left / <span class="hljs-property">@indent_px</span>) <span class="hljs-keyword">else</span> pos_x = <span class="hljs-number">0</span>
    pos_x = <span class="hljs-property">@max_indent</span> <span class="hljs-keyword">if</span> pos_x &gt; <span class="hljs-property">@max_indent</span>
    pos_x</div></div></div></div></body></html>
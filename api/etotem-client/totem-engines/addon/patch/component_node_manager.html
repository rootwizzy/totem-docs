<!DOCTYPE html><html lang="en"><head><title>totem-engines/addon/patch/component_node_manager</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../"><meta name="groc-document-path" content="totem-engines/addon/patch/component_node_manager"><meta name="groc-project-path" content="totem-engines/addon/patch/component_node_manager.coffee"><meta name="groc-github-url" content="https://github.com/sixthedge/etotem-client"><link rel="stylesheet" type="text/css" media="all" href="../../../assets/style.css"><script type="text/javascript" src="../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/sixthedge/etotem-client/blob/master/totem-engines/addon/patch/component_node_manager.coffee">totem-engines/addon/patch/component_node_manager.coffee</a></div></div><div id="document"><a href="/" class="lodestar-link">Back to Guides</a><div class="segment"><div class="code"><div class="wrapper">import ember from <span class="hljs-string">'ember'</span>

erequire = ember.__loader.<span class="hljs-built_in">require</span>
ncm      = erequire(<span class="hljs-string">'ember-htmlbars/node-managers/component-node-manager'</span>).default</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>When a routeable engine mounts a routeless engine, the routeless engine&#39;s component life-cycle hooks
are not called.  Ember performs a &#39;revalidate&#39; only on the top level views to perform the &#39;dispatchLifecycleHooks.
However, the life-cycle hooks have been added to nested views and are never performed.
This adds the &#39;didInsertElement&#39; life-cycle hook for the component&#39;s top-level view (e.g. ownerView).</p></div></div><div class="code"><div class="wrapper">export default -&gt;
  original_render = ncm.prototype.render
  ncm.prototype.render = <span class="hljs-function"><span class="hljs-params">(_env, visitor)</span> -&gt;</span>
    component = <span class="hljs-property">@component</span>
    original_render.call(@, _env, visitor)
    <span class="hljs-keyword">if</span> _env.lifecycleHooks.length &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> component._state == <span class="hljs-string">'hasElement'</span>
      owner_view = component.ownerView
      owner_view._env.lifecycleHooks.push({ <span class="hljs-attribute">type</span>: <span class="hljs-string">'didInsertElement'</span>, <span class="hljs-attribute">view</span>: component })</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Originally tried the below, but the &#39;didInsertElement&#39; hook was called to early and the component was not actually in the DOM yet:
_env.renderer.dispatchLifecycleHooks(_env) if _env.lifecycleHooks.length &gt; 0 and component._state == &#39;hasElement&#39;</p></div></div></div></div></body></html>
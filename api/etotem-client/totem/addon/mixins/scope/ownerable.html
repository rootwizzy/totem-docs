<!DOCTYPE html><html lang="en"><head><title>totem/addon/mixins/scope/ownerable</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../../"><meta name="groc-document-path" content="totem/addon/mixins/scope/ownerable"><meta name="groc-project-path" content="totem/addon/mixins/scope/ownerable.coffee"><meta name="groc-branch-path" content="development"><meta name="groc-github-url" content="https://github.com/sixthedge/etotem-client"><link rel="stylesheet" type="text/css" media="all" href="../../../../assets/style.css"><script type="text/javascript" src="../../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/sixthedge/etotem-client/blob/development/totem/addon/mixins/scope/ownerable.coffee">totem/addon/mixins/scope/ownerable.coffee</a></div></div><div id="document"><a href="/" class="lodestar-link">Back to Guides</a><div class="segment"><div class="code"><div class="wrapper">import ember from <span class="hljs-string">'ember'</span>

export default ember.Mixin.create</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Store the ownerable values used by the rest adapter/serializer.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">ownerable_type_attr</span>: <span class="hljs-literal">null</span>
  <span class="hljs-attribute">ownerable_id_attr</span>:   <span class="hljs-literal">null</span>
  <span class="hljs-attribute">ownerable_type</span>:      <span class="hljs-literal">null</span>
  <span class="hljs-attribute">ownerable_id</span>:        <span class="hljs-literal">null</span>
  <span class="hljs-attribute">ownerable_record</span>:    <span class="hljs-literal">null</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Sets the ownerable AND the current_path and current_ids as the ownerable for filters.
e.g. use to switch filters from users to teams or vice-versa.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">ownerable</span>: <span class="hljs-function"><span class="hljs-params">(ownerable, options={})</span> -&gt;</span>
    <span class="hljs-property">@set_ownerable</span>(ownerable, options)
    <span class="hljs-property">@current_path_and_ids_to_ownerable</span>()</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Convience function to set the ownerable and current path/ids to the current_user.
Same as totem_scope.ownerable(null, options) but more descriptive.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">ownerable_to_current_user</span>: <span class="hljs-function"><span class="hljs-params">(options={})</span> -&gt;</span> <span class="hljs-property">@ownerable</span> <span class="hljs-property">@get_current_user</span>(), options</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set the current path and ids to the ownerable.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">current_path_and_ids_to_ownerable</span>: <span class="hljs-function"><span class="hljs-params">(options={})</span> -&gt;</span>
    <span class="hljs-property">@set_current_path_and_ids</span> <span class="hljs-property">@get_ownerable_type</span>(), <span class="hljs-property">@get_ownerable_id</span>()</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Ownerable getters.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">get_default_ownerable_type_attr</span>: <span class="hljs-function">-&gt;</span> <span class="hljs-string">'ownerable_type'</span>
  <span class="hljs-attribute">get_default_ownerable_id_attr</span>:   <span class="hljs-function">-&gt;</span> <span class="hljs-string">'ownerable_id'</span>
  <span class="hljs-attribute">get_ownerable_type_attr</span>:         <span class="hljs-function">-&gt;</span> <span class="hljs-property">@get</span>(<span class="hljs-string">'ownerable_type_attr'</span>) <span class="hljs-keyword">or</span> <span class="hljs-property">@get_default_ownerable_type_attr</span>()  <span class="hljs-comment"># the record's attribute containing the ownerable type</span>
  <span class="hljs-attribute">get_ownerable_id_attr</span>:           <span class="hljs-function">-&gt;</span> <span class="hljs-property">@get</span>(<span class="hljs-string">'ownerable_id_attr'</span>)   <span class="hljs-keyword">or</span> <span class="hljs-property">@get_default_ownerable_id_attr</span>()    <span class="hljs-comment"># the record's attribute containing the ownerable id</span>
  <span class="hljs-attribute">get_ownerable_type</span>:              <span class="hljs-function">-&gt;</span> <span class="hljs-property">@get</span> <span class="hljs-string">'ownerable_type'</span>
  <span class="hljs-attribute">get_ownerable_id</span>:                <span class="hljs-function">-&gt;</span> <span class="hljs-property">@get</span> <span class="hljs-string">'ownerable_id'</span>
  <span class="hljs-attribute">get_ownerable_record</span>:            <span class="hljs-function">-&gt;</span> <span class="hljs-property">@get</span>(<span class="hljs-string">'ownerable_record'</span>) <span class="hljs-keyword">or</span> <span class="hljs-property">@get_current_user</span>()

  <span class="hljs-attribute">has_ownerable</span>:          <span class="hljs-function">-&gt;</span> <span class="hljs-property">@get_ownerable_type</span>() <span class="hljs-keyword">and</span> <span class="hljs-property">@get_ownerable_id</span>()
  <span class="hljs-attribute">ownerable_is_type_user</span>: <span class="hljs-function">-&gt;</span> <span class="hljs-property">@get_ownerable_type</span>() == <span class="hljs-property">@get_current_user_type</span>()</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set the ownerable type and ownerable id from the record (default to current user if record is null).
Optionally, an ownerable type and id attribute can be specified if different from &#39;ownerable_type&#39; and &#39;ownerable_id&#39;.</p>
<ul>
<li>If ember-data does not resolve a polymophic into the actual record, can use &#39;ownerable.type&#39; and &#39;ownerable.id&#39;.</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">set_ownerable</span>: <span class="hljs-function"><span class="hljs-params">(record=<span class="hljs-literal">null</span>, options={})</span> -&gt;</span>
    record   ?= <span class="hljs-property">@get_current_user</span>()
    type_attr = options.type_attr
    id_attr   = options.id_attr
    id_attr   = type_attr.replace(<span class="hljs-string">'type'</span>, <span class="hljs-string">'id'</span>)  <span class="hljs-keyword">if</span> type_attr <span class="hljs-keyword">and</span> (<span class="hljs-keyword">not</span> id_attr)
    type      = <span class="hljs-property">@get_record_path</span>(record)
    id        = record.get(<span class="hljs-string">'id'</span>)
    <span class="hljs-property">@set</span> <span class="hljs-string">'ownerable_type'</span>, type
    <span class="hljs-property">@set</span> <span class="hljs-string">'ownerable_id'</span>, parseInt(id)
    <span class="hljs-property">@set</span> <span class="hljs-string">'ownerable_type_attr'</span>, type_attr
    <span class="hljs-property">@set</span> <span class="hljs-string">'ownerable_id_attr'</span>, id_attr
    <span class="hljs-property">@set</span> <span class="hljs-string">'ownerable_record'</span>, record</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set a record&#39;s ownerable attributes to the totem scope&#39;s ownerable type and id.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">set_record_ownerable_attributes</span>: <span class="hljs-function"><span class="hljs-params">(record)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">unless</span> record
    type_attr = <span class="hljs-property">@get_ownerable_type_attr</span>()
    id_attr   = <span class="hljs-property">@get_ownerable_id_attr</span>()
    record.eachAttribute (rec_attr) =&gt;
      <span class="hljs-keyword">switch</span> rec_attr
        <span class="hljs-keyword">when</span> type_attr
          record.set type_attr, <span class="hljs-property">@get_ownerable_type</span>()
        <span class="hljs-keyword">when</span> id_attr
          record.set id_attr, <span class="hljs-property">@get_ownerable_id</span>()</div></div></div></div></body></html>
<!DOCTYPE html><html lang="en"><head><title>totem/addon/util_ember</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="totem/addon/util_ember"><meta name="groc-project-path" content="totem/addon/util_ember.coffee"><meta name="groc-github-url" content="https://github.com/sixthedge/etotem-client"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/sixthedge/etotem-client/blob/master/totem/addon/util_ember.coffee">totem/addon/util_ember.coffee</a></div></div><div id="document"><a href="/" class="lodestar-link">Back to Guides</a><div class="segment"><div class="code"><div class="wrapper">import ember from <span class="hljs-string">'ember'</span>
import ds    from <span class="hljs-string">'ember-data'</span>
import util  from <span class="hljs-string">'totem/util'</span>
import {module_prefix} from <span class="hljs-string">'totem-config/config'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Utility functions that require ember.
Some functions are pass-through to totem/util.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UtilityEmber</span></span>

  <span class="hljs-attribute">app_path</span>: <span class="hljs-function"><span class="hljs-params">(path)</span> -&gt;</span> <span class="hljs-string">"<span class="hljs-subst">#{module_prefix}</span>/<span class="hljs-subst">#{path}</span>"</span>

  <span class="hljs-attribute">is_integer</span>:  <span class="hljs-function"><span class="hljs-params">(num)</span> -&gt;</span> num <span class="hljs-keyword">and</span> <span class="hljs-string">"<span class="hljs-subst">#{num}</span>"</span>.match(<span class="hljs-regexp">/^\d+$/</span>)
  <span class="hljs-attribute">is_number</span>:   <span class="hljs-function"><span class="hljs-params">(num)</span> -&gt;</span> Number(num).toString() != <span class="hljs-string">'NaN'</span>

  <span class="hljs-attribute">is_string</span>:   <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> obj <span class="hljs-keyword">and</span> <span class="hljs-keyword">typeof</span>(obj) == <span class="hljs-string">'string'</span>
  <span class="hljs-attribute">is_hash</span>:     <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> obj <span class="hljs-keyword">and</span> <span class="hljs-keyword">typeof</span>(obj) == <span class="hljs-string">'object'</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> ember.isArray(obj)
  <span class="hljs-attribute">is_function</span>: <span class="hljs-function"><span class="hljs-params">(fn)</span>  -&gt;</span> fn  <span class="hljs-keyword">and</span> <span class="hljs-keyword">typeof</span>(fn) == <span class="hljs-string">'function'</span>
  <span class="hljs-attribute">is_array</span>:    <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> obj <span class="hljs-keyword">and</span> ember.isArray(obj)

  <span class="hljs-attribute">is_object_function</span>: <span class="hljs-function"><span class="hljs-params">(obj, fn)</span> -&gt;</span> <span class="hljs-property">@is_hash</span>(obj) <span class="hljs-keyword">and</span> <span class="hljs-property">@is_string</span>(fn) <span class="hljs-keyword">and</span> <span class="hljs-property">@is_function</span>(obj[fn])

  <span class="hljs-attribute">is_changeset</span>: <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> <span class="hljs-property">@is_hash</span>(obj) <span class="hljs-keyword">and</span> obj.__changeset__ == <span class="hljs-string">'__CHANGESET__'</span>
  <span class="hljs-attribute">is_component</span>: <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> <span class="hljs-property">@is_get</span>(obj) <span class="hljs-keyword">and</span> obj.get(<span class="hljs-string">'isComponent'</span>) == <span class="hljs-literal">true</span>
  <span class="hljs-attribute">is_get</span>:       <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> <span class="hljs-property">@is_object_function</span>(obj, <span class="hljs-string">'get'</span>)

  <span class="hljs-attribute">is_mixin</span>:   <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> obj <span class="hljs-keyword">and</span> obj <span class="hljs-keyword">instanceof</span> ember.Mixin
  <span class="hljs-attribute">is_promise</span>: <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> obj <span class="hljs-keyword">and</span> obj <span class="hljs-keyword">instanceof</span> ember.RSVP.Promise
  <span class="hljs-attribute">is_model</span>:   <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> obj <span class="hljs-keyword">and</span> obj <span class="hljs-keyword">instanceof</span> ds.Model
  <span class="hljs-attribute">is_jquery</span>:  <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> obj <span class="hljs-keyword">and</span> jQuery <span class="hljs-keyword">and</span> obj <span class="hljs-keyword">instanceof</span>(jQuery)

  <span class="hljs-attribute">is_destroyed</span>: <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> <span class="hljs-property">@is_get</span>(obj) <span class="hljs-keyword">and</span> (obj.get(<span class="hljs-string">'isDestroyed'</span>) <span class="hljs-keyword">or</span> obj.get(<span class="hljs-string">'isDestroying'</span>))

  <span class="hljs-attribute">has_keys</span>:    <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> ember.isPresent <span class="hljs-property">@object_keys</span>(obj)
  <span class="hljs-attribute">object_keys</span>: <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> (<span class="hljs-property">@is_hash</span>(obj) <span class="hljs-keyword">and</span> Object.keys(obj)) <span class="hljs-keyword">or</span> []

  <span class="hljs-attribute">hash_keys</span>:   <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> <span class="hljs-property">@object_keys</span>(obj) <span class="hljs-comment"># alias for object_keys</span>
  <span class="hljs-attribute">hash_values</span>: <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> <span class="hljs-property">@is_hash</span>(obj) <span class="hljs-keyword">and</span> ((v) <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">of</span> obj)
  <span class="hljs-attribute">dup_hash</span>:    <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> ember.assign {}, (<span class="hljs-property">@is_hash</span>(obj) <span class="hljs-keyword">and</span> obj) <span class="hljs-keyword">or</span> {}

  <span class="hljs-attribute">delete_blank_hash_keys</span>: <span class="hljs-function"><span class="hljs-params">(hash)</span> -&gt;</span> (<span class="hljs-keyword">delete</span>(hash[key]) <span class="hljs-keyword">if</span> ember.isBlank(hash[key])) <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> <span class="hljs-property">@object_keys</span>(hash)
  <span class="hljs-attribute">delete_blank_hash_keys_except</span>: <span class="hljs-function"><span class="hljs-params">(hash, except...)</span> -&gt;</span>
    (<span class="hljs-keyword">delete</span>(hash[key]) <span class="hljs-keyword">if</span> ember.isBlank(hash[key]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> except.includes(key)) <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> <span class="hljs-property">@object_keys</span>(hash)

  <span class="hljs-attribute">pluralize</span>: <span class="hljs-function"><span class="hljs-params">(str, count=<span class="hljs-number">1</span>, plural=<span class="hljs-literal">null</span>)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">'bad pluralize string'</span> <span class="hljs-keyword">unless</span> <span class="hljs-property">@is_string</span>(str)
    <span class="hljs-keyword">return</span> <span class="hljs-string">'bad pluralize count'</span>  <span class="hljs-keyword">unless</span> <span class="hljs-property">@is_integer</span>(count)
    <span class="hljs-keyword">if</span> <span class="hljs-property">@convert_to_number</span>(count) &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">then</span> (plural <span class="hljs-keyword">or</span> str.pluralize()) <span class="hljs-keyword">else</span> str

  <span class="hljs-attribute">convert_to_number</span>: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span> Number(n)

  <span class="hljs-attribute">require_module</span>: <span class="hljs-function"><span class="hljs-params">(path)</span> -&gt;</span>
    mod = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">try</span>
      mod = <span class="hljs-built_in">require</span> path
    <span class="hljs-keyword">catch</span> e
    <span class="hljs-keyword">finally</span>
      <span class="hljs-keyword">return</span> (mod <span class="hljs-keyword">and</span> mod.default)

  <span class="hljs-attribute">stringify</span>: <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span> JSON.stringify(obj)

  <span class="hljs-attribute">number_of_decimals</span>: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> <span class="hljs-keyword">unless</span> <span class="hljs-property">@is_number</span>(n)
    [v, decimals]  = (<span class="hljs-string">''</span> + n).split(<span class="hljs-string">'.'</span>)
    <span class="hljs-keyword">if</span> ember.isBlank(decimals) <span class="hljs-keyword">then</span> <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> decimals.length

  <span class="hljs-attribute">decimal_value</span>: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> <span class="hljs-keyword">unless</span> <span class="hljs-property">@is_number</span>(n)
    [v, decimals]  = (<span class="hljs-string">''</span> + n).split(<span class="hljs-string">'.'</span>)
    <span class="hljs-keyword">if</span> ember.isBlank(decimals) <span class="hljs-keyword">then</span> <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> Number(decimals)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="">#</h2>
<h3 id="messages">Messages.</h3>
<h2 id="">#</h2></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">warn</span>:  <span class="hljs-function"><span class="hljs-params">(source, args...)</span> -&gt;</span> <span class="hljs-built_in">console</span>.warn <span class="hljs-property">@get_log_message</span>(source, args), args...
  <span class="hljs-attribute">error</span>: <span class="hljs-function"><span class="hljs-params">(source, args...)</span> -&gt;</span>
    message = <span class="hljs-property">@get_log_message</span>(source, args)
    <span class="hljs-built_in">console</span>.error message, args...
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ember.Error message

  <span class="hljs-attribute">get_log_message</span>: <span class="hljs-function"><span class="hljs-params">(source, args)</span> -&gt;</span>
    message = <span class="hljs-string">''</span>
    <span class="hljs-keyword">switch</span>
      <span class="hljs-keyword">when</span> <span class="hljs-property">@is_string</span>(source)  <span class="hljs-keyword">then</span> message = source
      <span class="hljs-keyword">when</span> <span class="hljs-property">@is_hash</span>(source)
        arg      = <span class="hljs-keyword">if</span> <span class="hljs-property">@is_string</span>(args[<span class="hljs-number">0</span>]) <span class="hljs-keyword">then</span> args.shift() <span class="hljs-keyword">else</span> <span class="hljs-literal">null</span>
        message += <span class="hljs-string">"<span class="hljs-subst">#{source.toString()}</span>: "</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@is_object_function</span>(source, <span class="hljs-string">'toString'</span>)
        message += arg <span class="hljs-keyword">if</span> <span class="hljs-property">@is_string</span>(arg)
    message</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="pass-through-">Pass Through ###</h3></div></div></div><div class="segment"><div class="code"><div class="wrapper">  <span class="hljs-attribute">starts_with</span>:   <span class="hljs-function">-&gt;</span> util.starts_with(arguments...)
  <span class="hljs-attribute">ends_with</span>:     <span class="hljs-function">-&gt;</span> util.ends_with(arguments...)
  <span class="hljs-attribute">rjust</span>:         <span class="hljs-function">-&gt;</span> util.rjust(arguments...)
  <span class="hljs-attribute">ljust</span>:         <span class="hljs-function">-&gt;</span> util.ljust(arguments...)
  <span class="hljs-attribute">flatten_array</span>: <span class="hljs-function">-&gt;</span> util.flatten_array(arguments...)

  <span class="hljs-attribute">current_date</span>:           <span class="hljs-function">-&gt;</span> util.current_date()
  <span class="hljs-attribute">date_time</span>:              <span class="hljs-function">-&gt;</span> <span class="hljs-property">@util</span>.date_time(arguments...)
  <span class="hljs-attribute">date_time_milliseconds</span>: <span class="hljs-function">-&gt;</span> util.date_time_milliseconds(arguments...)

  <span class="hljs-attribute">add_path_objects</span>: <span class="hljs-function">-&gt;</span> util.add_path_objsect(arguments...)
  <span class="hljs-attribute">set_path_value</span>:   <span class="hljs-function">-&gt;</span> util.set_path_value(arguments...)

export default <span class="hljs-keyword">new</span> UtilityEmber</div></div></div></div></body></html>
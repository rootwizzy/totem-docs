<!DOCTYPE html><html lang="en"><head><title>totem/client/totem/addon/mixins/scope/paths</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../../../../"><meta name="groc-document-path" content="totem/client/totem/addon/mixins/scope/paths"><meta name="groc-project-path" content="src/totem/client/totem/addon/mixins/scope/paths.coffee"><meta name="groc-branch-path" content="feature/pe-documentation"><meta name="groc-github-url" content="https://github.com/sixthedge/cellar"><link rel="stylesheet" type="text/css" media="all" href="../../../../../../assets/style.css"><script type="text/javascript" src="../../../../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/sixthedge/cellar/blob/feature/pe-documentation/src/totem/client/totem/addon/mixins/scope/paths.coffee">src/totem/client/totem/addon/mixins/scope/paths.coffee</a></div></div><div id="document"><a href="/" class="lodestar-link">Back to Guides</a><div class="segment"><div class="code"><div class="wrapper">import ember from <span class="hljs-string">'ember'</span>

export default ember.Mixin.create</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Contains all paths and ids that are used in filters; path_ids[path-name] = [ids].</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">path_ids</span>: {}

  <span class="hljs-attribute">get_path_ids</span>: <span class="hljs-function"><span class="hljs-params">(path)</span> -&gt;</span> <span class="hljs-property">@get</span> <span class="hljs-string">"path_ids.<span class="hljs-subst">#{path}</span>"</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set the path ids and send an ids change notification.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">set_path_ids</span>: <span class="hljs-function"><span class="hljs-params">(path, ids)</span> -&gt;</span>
    path <span class="hljs-keyword">and</span> <span class="hljs-property">@set</span> <span class="hljs-string">"path_ids.<span class="hljs-subst">#{path}</span>"</span>, <span class="hljs-property">@make_ids_array</span>(ids)
    <span class="hljs-property">@notify_path_ids_property_change</span>()

  <span class="hljs-attribute">reset_all_ids</span>:         <span class="hljs-function">-&gt;</span> <span class="hljs-property">@set</span> <span class="hljs-string">'path_ids'</span>, {}
  <span class="hljs-attribute">reset_path_ids</span>: <span class="hljs-function"><span class="hljs-params">(path)</span> -&gt;</span> <span class="hljs-property">@set_path_ids</span> path, <span class="hljs-literal">null</span>

  <span class="hljs-attribute">notify_path_ids_property_change</span>: <span class="hljs-function">-&gt;</span> <span class="hljs-property">@notifyPropertyChange</span>(<span class="hljs-string">'path_ids'</span>)

  <span class="hljs-attribute">path_ids_blank</span>:   <span class="hljs-function"><span class="hljs-params">(path)</span> -&gt;</span> path <span class="hljs-keyword">and</span> <span class="hljs-property">@is_blank</span>(<span class="hljs-property">@get_path_ids</span> path)
  <span class="hljs-attribute">path_ids_present</span>: <span class="hljs-function"><span class="hljs-params">(path)</span> -&gt;</span> <span class="hljs-keyword">not</span> <span class="hljs-property">@path_ids_blank</span>(path)

  <span class="hljs-attribute">can_view_path_id</span>: <span class="hljs-function"><span class="hljs-params">(path, id)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">unless</span> (path <span class="hljs-keyword">and</span> id)
    ids = <span class="hljs-property">@get_path_ids</span>(path) <span class="hljs-keyword">or</span> []
    id <span class="hljs-keyword">in</span> ids</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Map of each path to the filter attribute(s) on a record.  Typically, this will be the same as the ownerable
type and id attributes, but if different (e.g. want to filter on just &#39;user_id&#39;), it can be set for a path.
The path&#39;s type and id attributes are set as: path_to_attrs.path-name = {type: type-attr, id: id-attr}.
&#39;Get&#39; returns the specific path&#39;s type/id or will default to the &#39;ownerable&#39; type/id (either is set or will be the default).</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">path_to_attrs</span>: {}
  <span class="hljs-attribute">get_path_type_attr</span>: <span class="hljs-function"><span class="hljs-params">(path=<span class="hljs-literal">null</span>)</span> -&gt;</span> (path <span class="hljs-keyword">and</span> <span class="hljs-property">@get</span> <span class="hljs-string">"path_to_attrs.<span class="hljs-subst">#{path}</span>.type"</span>) <span class="hljs-keyword">or</span> <span class="hljs-property">@get_ownerable_type_attr</span>()
  <span class="hljs-attribute">get_path_id_attr</span>:   <span class="hljs-function"><span class="hljs-params">(path=<span class="hljs-literal">null</span>)</span> -&gt;</span> (path <span class="hljs-keyword">and</span> <span class="hljs-property">@get</span> <span class="hljs-string">"path_to_attrs.<span class="hljs-subst">#{path}</span>.id"</span>)   <span class="hljs-keyword">or</span> <span class="hljs-property">@get_ownerable_id_attr</span>()
  <span class="hljs-attribute">set_path_attrs</span>: <span class="hljs-function"><span class="hljs-params">(path, attrs)</span>   -&gt;</span> path <span class="hljs-keyword">and</span> (<span class="hljs-property">@set</span> <span class="hljs-string">"path_to_attrs.<span class="hljs-subst">#{path}</span>"</span>, attrs)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="">#</h2>
<h3 id="current-path-and-ids">Current path and ids.</h3>
<h2 id="">#</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Current path is used to return ids from the &#39;path_ids&#39; object e.g. path_ids[current_path].
The current path ids are used by the record association filters.
Typically, the current path (and ids) are set when setting the &#39;ownerable&#39; but
can be manually set to any path/ids.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">current_path</span>: <span class="hljs-literal">null</span>

  <span class="hljs-attribute">get_current_path</span>: <span class="hljs-function">-&gt;</span> <span class="hljs-property">@get</span>(<span class="hljs-string">'current_path'</span>)
  <span class="hljs-attribute">get_current_ids</span>:  <span class="hljs-function">-&gt;</span> <span class="hljs-property">@get_path_ids</span> <span class="hljs-property">@get_current_path</span>()

  <span class="hljs-attribute">set_current_path</span>: <span class="hljs-function"><span class="hljs-params">(path=<span class="hljs-literal">null</span>)</span> -&gt;</span> <span class="hljs-property">@set</span> <span class="hljs-string">'current_path'</span>, path</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Current ids represent the ids in path_ids[current_path] (e.g. not a current_ids property).
Anytime the &#39;path_ids&#39; are set, an ids change notification is sent.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">set_current_ids</span>: <span class="hljs-function"><span class="hljs-params">(ids)</span> -&gt;</span> <span class="hljs-property">@set_path_ids</span>(<span class="hljs-property">@get_current_path</span>(), ids)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set the current path then set path_ids[current_path] = ids.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">set_current_path_and_ids</span>: <span class="hljs-function"><span class="hljs-params">(path, ids)</span> -&gt;</span>
    <span class="hljs-property">@set_current_path</span>(path)
    <span class="hljs-property">@set_current_ids</span>(ids)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Change the current path value.
If path is already the current path then return, else since a path change, notify the ids have changed.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">change_current_path</span>: <span class="hljs-function"><span class="hljs-params">(path=<span class="hljs-literal">null</span>)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@get_current_path</span>() == path
    <span class="hljs-property">@set_current_path</span>(path)
    <span class="hljs-property">@notify_path_ids_property_change</span>()

  <span class="hljs-attribute">current_path_blank</span>:   <span class="hljs-function">-&gt;</span> <span class="hljs-keyword">not</span> <span class="hljs-property">@get_current_path</span>()
  <span class="hljs-attribute">current_path_present</span>: <span class="hljs-function">-&gt;</span> <span class="hljs-keyword">not</span> <span class="hljs-property">@current_path_blank</span>()
  <span class="hljs-attribute">current_ids_blank</span>:    <span class="hljs-function">-&gt;</span> <span class="hljs-keyword">not</span> <span class="hljs-property">@path_ids_blank</span>(<span class="hljs-property">@get_current_path</span>())
  <span class="hljs-attribute">current_ids_present</span>:  <span class="hljs-function">-&gt;</span> <span class="hljs-keyword">not</span> <span class="hljs-property">@current_ids_blank</span>()</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="">#</h2>
<h3 id="user-convience-functions">User convience functions.</h3>
<h2 id="">#</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Users are the typical case and these functions are conviences to the &#39;current&#39; path/ids functions.</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Computed property that templates can use to test if user ids are blank e.g. whether viewing
a user that is not the current user (user ids = [current user id] is also considered blank).</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">view_user_ids_blank</span>: ember.computed <span class="hljs-string">'path_ids'</span>, <span class="hljs-string">'current_user_id'</span>, <span class="hljs-function">-&gt;</span> <span class="hljs-property">@is_user_ids_current_user</span>()</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Alias computed property for &#39;view_user_ids_blank&#39;.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">view_user_is_current_user</span>: ember.computed.reads <span class="hljs-string">'view_user_ids_blank'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The users&#39; path will be created from the current_user if not populated.
It has many references so create once and store it rather than at each request.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">user_ids_path</span>: <span class="hljs-literal">null</span>
  <span class="hljs-attribute">get_user_ids_path</span>: <span class="hljs-function">-&gt;</span> <span class="hljs-property">@get</span>(<span class="hljs-string">'user_ids_path'</span>) <span class="hljs-keyword">or</span> <span class="hljs-property">@set_user_ids_path</span>()
  <span class="hljs-attribute">set_user_ids_path</span>: <span class="hljs-function"><span class="hljs-params">(user=<span class="hljs-property">@get_current_user</span>())</span> -&gt;</span>
    <span class="hljs-property">@set</span> <span class="hljs-string">'user_ids_path'</span>, <span class="hljs-property">@get_record_path</span>(user)
    <span class="hljs-property">@get</span> <span class="hljs-string">'user_ids_path'</span>

  <span class="hljs-attribute">get_user_ids</span>: <span class="hljs-function">-&gt;</span> <span class="hljs-property">@get_path_ids</span> <span class="hljs-property">@get_user_ids_path</span>()

  <span class="hljs-attribute">is_user_ids_current_path</span>: <span class="hljs-function">-&gt;</span> <span class="hljs-property">@current_path_blank</span>() <span class="hljs-keyword">or</span> <span class="hljs-property">@get_current_path</span>() == <span class="hljs-property">@get_user_ids_path</span>()</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set the user&#39;s path to filter on a single attribute (e.g. &#39;user_id&#39;) when does not have ownerable polymorphic.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">set_user_ids_path_attr</span>: <span class="hljs-function"><span class="hljs-params">(attr=<span class="hljs-string">'user_id'</span>)</span> -&gt;</span>
    <span class="hljs-property">@set_path_attrs</span> <span class="hljs-property">@get_user_ids_path</span>(), {<span class="hljs-attribute">id</span>: attr}

  <span class="hljs-attribute">is_user_ids_current_user</span>: <span class="hljs-function">-&gt;</span>
    ids = <span class="hljs-property">@get_user_ids</span>()
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-keyword">unless</span> ids  <span class="hljs-comment"># if user ids have not been set yet, then is the current user</span>
    ids.get(<span class="hljs-string">'length'</span>) == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> ids.objectAt(<span class="hljs-number">0</span>) == <span class="hljs-property">@get_current_user_id</span>()</div></div></div></div></body></html>
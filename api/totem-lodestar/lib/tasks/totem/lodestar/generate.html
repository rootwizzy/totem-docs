<!DOCTYPE html><html lang="en"><head><title>lib/tasks/totem/lodestar/generate</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../../"><meta name="groc-document-path" content="lib/tasks/totem/lodestar/generate"><meta name="groc-project-path" content="lib/tasks/totem/lodestar/generate.rake"><meta name="groc-branch-path" content="master"><meta name="groc-github-url" content="https://github.com/sixthedge/totem-lodestar"><link rel="stylesheet" type="text/css" media="all" href="../../../../assets/style.css"><script type="text/javascript" src="../../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/sixthedge/totem-lodestar/blob/master/lib/tasks/totem/lodestar/generate.rake">lib/tasks/totem/lodestar/generate.rake</a></div></div><div id="document"><a href="/" class="lodestar-link">Back to Guides</a><div class="segment"><div class="code"><div class="wrapper">require_relative <span class="hljs-string">'helpers/guides_generator'</span>
require_relative <span class="hljs-string">'helpers/api_generator'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h1 id="totem-lodestar-tasks">Totem Lodestar Tasks</h1>
<p>These are used to build the markdown and source documentation during the build process. These may be called either locally during development or used within the <strong>.travis.yml</strong> build script.</p></div></div><div class="code"><div class="wrapper">namespace <span class="hljs-symbol">:totem</span> <span class="hljs-keyword">do</span>
  namespace <span class="hljs-symbol">:lodestar</span> <span class="hljs-keyword">do</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>rails totem:lodestar:generate</code></p>
<p>Generate uses the <strong>GuidesGenerator</strong> helpers to build the markdown documents for the guides section of lodestar. This two step process first scrapes the designated documents folder and builds a hash tree that mimics the files and structure. The second part migrates the files into the database removing any deleted documents.</p></div></div><div class="code"><div class="wrapper">    desc <span class="hljs-string">"Parses markdown documents then migrates to the database"</span>
    task <span class="hljs-symbol">generate:</span> <span class="hljs-symbol">:environment</span> <span class="hljs-keyword">do</span>
      <span class="hljs-keyword">include</span> <span class="hljs-constant">Totem::Lodestar::GuidesGenerator::Migrator</span>, <span class="hljs-constant">Totem::Lodestar::GuidesGenerator::Parser</span>
      generate_document_structure
      migrate_document_structure
    <span class="hljs-keyword">end</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>rails totem:lodestar:reset_slugs</code></p>
<p>Reset slugs is used if there are conflicting slugs for the URL. This will happen if a file/folder happen to use the same string, thus requiring <strong>friendly_id</strong> to generate a very <em>unfriendly</em> id. After fixing the conflict run this command to wipe the existing slug associations which will re-build after accessing those files again.</p></div></div><div class="code"><div class="wrapper">    desc <span class="hljs-string">"Regenerates all slugs"</span>
    task <span class="hljs-symbol">reset_slugs:</span> <span class="hljs-symbol">:environment</span> <span class="hljs-keyword">do</span>
      [<span class="hljs-constant">Version</span>, <span class="hljs-constant">Section</span>, <span class="hljs-constant">Document</span>].each {|klass| klass.all.each {|record| record.slug = <span class="hljs-keyword">nil</span>; record.save}}
    <span class="hljs-keyword">end</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>rails totem:lodestar:api[build,local]</code> </p>
<p>API builds the source code documentation through a forked version of <strong>Groc</strong> and <strong>ApiGenerator</strong>. The generated html is then put into the API folder in the base directory and is served as static assets with corresponding links for rails to navigate to. Without options this just migrates the repos titles for use in linking, building must first be done locally then pushed for production using the two options below. </p>
<ul>
<li><code>build</code>: Runs the source parser (groc) to generate the API documents</li>
<li><code>local</code>: Used for local testing, pulls local directory instead of remote github repo</li>
</ul></div></div><div class="code"><div class="wrapper">    desc <span class="hljs-string">"Generate API documentation"</span>
    task <span class="hljs-symbol">:api</span>, [<span class="hljs-symbol">:build</span>, <span class="hljs-symbol">:local</span>] =&gt; [<span class="hljs-symbol">:environment</span>] <span class="hljs-keyword">do</span>
      |t, args|
      <span class="hljs-keyword">include</span> <span class="hljs-constant">Totem::Lodestar::ApiGenerator</span>
      build = args.build.eql?(<span class="hljs-string">"build"</span>) ? <span class="hljs-keyword">true</span> <span class="hljs-symbol">:</span> <span class="hljs-keyword">false</span>
      local = args.local.eql?(<span class="hljs-string">"local"</span>) ? <span class="hljs-keyword">true</span> <span class="hljs-symbol">:</span> <span class="hljs-keyword">false</span>
      generate_api_documents(build, local)
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></div></div></div></div></body></html>
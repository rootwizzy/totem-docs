<!DOCTYPE html><html lang="en"><head><title>thinkspace-weather-forecaster/app/concerns/thinkspace/weather_forecaster/utility/print_table</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../../../../"><meta name="groc-document-path" content="thinkspace-weather-forecaster/app/concerns/thinkspace/weather_forecaster/utility/print_table"><meta name="groc-project-path" content="thinkspace-weather-forecaster/app/concerns/thinkspace/weather_forecaster/utility/print_table.rb"><meta name="groc-branch-path" content="development"><meta name="groc-github-url" content="https://github.com/sixthedge/ethinkspace-api"><link rel="stylesheet" type="text/css" media="all" href="../../../../../../assets/style.css"><script type="text/javascript" src="../../../../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/sixthedge/ethinkspace-api/blob/development/thinkspace-weather-forecaster/app/concerns/thinkspace/weather_forecaster/utility/print_table.rb">thinkspace-weather-forecaster/app/concerns/thinkspace/weather_forecaster/utility/print_table.rb</a></div></div><div id="document"><a href="/" class="lodestar-link">Back to Guides</a><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Thinkspace</span></span>
  <span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">WeatherForecaster</span></span>
    <span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Utility</span></span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Print Table records.  Mainly for Item and/or AssessmentItem record columns.
See documentation at end of this file or run a rake task with [help].</p></div></div><div class="code"><div class="wrapper">      <span class="hljs-keyword">require</span> <span class="hljs-string">'pp'</span>
      <span class="hljs-keyword">begin</span>
        <span class="hljs-keyword">require</span> <span class="hljs-string">'awesome_print'</span>
      <span class="hljs-keyword">rescue</span> <span class="hljs-constant">LoadError</span>
      <span class="hljs-keyword">end</span>

      <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PrintTable</span></span>

        <span class="hljs-keyword">attr_reader</span> <span class="hljs-symbol">:run_class</span>
        <span class="hljs-keyword">attr_reader</span> <span class="hljs-symbol">:run_scope</span>

        <span class="hljs-keyword">attr_reader</span> <span class="hljs-symbol">:arg_ids</span>
        <span class="hljs-keyword">attr_reader</span> <span class="hljs-symbol">:arg_order</span>
        <span class="hljs-keyword">attr_reader</span> <span class="hljs-symbol">:arg_scopes</span>
        <span class="hljs-keyword">attr_reader</span> <span class="hljs-symbol">:arg_str</span>

        <span class="hljs-keyword">attr_reader</span> <span class="hljs-symbol">:ap_options</span>
        <span class="hljs-keyword">attr_reader</span> <span class="hljs-symbol">:column_names</span>
        <span class="hljs-keyword">attr_reader</span> <span class="hljs-symbol">:show_help</span>

        <span class="hljs-keyword">attr_reader</span> <span class="hljs-symbol">:indent</span>
        <span class="hljs-keyword">attr_reader</span> <span class="hljs-symbol">:print_method</span>
        <span class="hljs-keyword">attr_reader</span> <span class="hljs-symbol">:compare_dup</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>
          <span class="hljs-variable">@arg_ids</span>      = <span class="hljs-constant">Array</span>.new
          <span class="hljs-variable">@arg_order</span>    = <span class="hljs-constant">Array</span>.new
          <span class="hljs-variable">@arg_scopes</span>   = <span class="hljs-constant">Array</span>.new
          <span class="hljs-variable">@show_help</span>    = <span class="hljs-keyword">false</span>
          <span class="hljs-variable">@indent</span>       = <span class="hljs-number">3</span>
          <span class="hljs-variable">@print_method</span> = <span class="hljs-symbol">:pp</span>
          <span class="hljs-variable">@compare_dup</span>  = <span class="hljs-keyword">false</span>
          <span class="hljs-variable">@ap_sort_keys</span> = <span class="hljs-keyword">true</span>
          <span class="hljs-variable">@ap_options</span>   = {<span class="hljs-symbol">index:</span> <span class="hljs-keyword">false</span>, <span class="hljs-symbol">indent:</span> <span class="hljs-number">3</span>}
        <span class="hljs-keyword">end</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="">#</h2>
<h3 id="supported-tables">Supported Tables.</h3>
<h2 id="">#</h2></div></div><div class="code"><div class="wrapper">        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">item_class</span>;</span>                <span class="hljs-constant">Thinkspace::WeatherForecaster::Item</span>; <span class="hljs-keyword">end</span>
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">assessment_item_class</span>;</span>     <span class="hljs-constant">Thinkspace::WeatherForecaster::AssessmentItem</span>; <span class="hljs-keyword">end</span>
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">station_class</span>;</span>             <span class="hljs-constant">Thinkspace::WeatherForecaster::Station</span>; <span class="hljs-keyword">end</span>
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">assessment_class</span>;</span>          <span class="hljs-constant">Thinkspace::WeatherForecaster::Assessment</span>; <span class="hljs-keyword">end</span>
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forecast_class</span>;</span>            <span class="hljs-constant">Thinkspace::WeatherForecaster::Forecast</span>; <span class="hljs-keyword">end</span>
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forecast_day_class</span>;</span>        <span class="hljs-constant">Thinkspace::WeatherForecaster::ForecastDay</span>; <span class="hljs-keyword">end</span>
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forecast_day_actual_class</span>;</span> <span class="hljs-constant">Thinkspace::WeatherForecaster::ForecastDayActual</span>; <span class="hljs-keyword">end</span>
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">response_class</span>;</span>            <span class="hljs-constant">Thinkspace::WeatherForecaster::Response</span>; <span class="hljs-keyword">end</span>
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">response_score_class</span>;</span>      <span class="hljs-constant">Thinkspace::WeatherForecaster::ResponseScore</span>; <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">all</span><span class="hljs-params">(args=<span class="hljs-keyword">nil</span>)</span></span>
          <span class="hljs-variable">@ap_sort_keys</span> = <span class="hljs-keyword">false</span>
          extract_and_validate_args(args)
          puts <span class="hljs-string">"Task 'all' has column names but they will be ignored (use task 'columns' if want a column based print)."</span> <span class="hljs-keyword">if</span> column_names.present?
          run_scope.each <span class="hljs-keyword">do</span> |item|
            print_sep <span class="hljs-symbol">:all</span>, item
            print_item item
          <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">columns</span><span class="hljs-params">(args=<span class="hljs-keyword">nil</span>)</span></span>
          extract_and_validate_args(args)
          stop_run <span class="hljs-string">"No column names specified in arguments e.g. [processing,response_metadata]"</span>  <span class="hljs-keyword">if</span> column_names.blank?
          run_scope.each <span class="hljs-keyword">do</span> |item|
            print_sep <span class="hljs-symbol">:columns</span>, item
            print_columns(item)
          <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compare</span><span class="hljs-params">(args=<span class="hljs-keyword">nil</span>)</span></span>
          extract_and_validate_args(args)
          <span class="hljs-keyword">if</span> run_class == item_class
            compare_dup ? compare_items_dup <span class="hljs-symbol">:</span> compare_items_no_dup
          <span class="hljs-keyword">else</span>
            compare_dup ? compare_assessment_items_dup <span class="hljs-symbol">:</span> stop_run(<span class="hljs-string">"Compare with no dups on assessment item class not supported."</span>)
          <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compare_items_dup</span></span>
          run_scope.each <span class="hljs-keyword">do</span> |item|
            item.thinkspace_weather_forecaster_assessment_items.each <span class="hljs-keyword">do</span> |assessment_item|
              print_sep <span class="hljs-string">"compare <span class="hljs-subst">#{get_item_text(item)}</span> ==&gt;"</span>, assessment_item
              print_columns item, get_item_text(item)
              print_columns assessment_item, get_item_text(assessment_item)
            <span class="hljs-keyword">end</span>
          <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compare_assessment_items_dup</span></span>
          run_scope.each <span class="hljs-keyword">do</span> |assessment_item|
            item = assessment_item.thinkspace_weather_forecaster_item
            print_sep <span class="hljs-string">"compare <span class="hljs-subst">#{get_item_text(assessment_item)}</span> ==&gt;"</span>, item
            print_columns assessment_item, get_item_text(assessment_item)
            print_columns item, get_item_text(item)
          <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Print the &#39;item&#39; data once followed by the assessment items (less print but harder to compare).</p></div></div><div class="code"><div class="wrapper">        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compare_items_no_dup</span></span>
          run_scope.each <span class="hljs-keyword">do</span> |item|
            print_sep <span class="hljs-symbol">:compare</span>, item
            print_columns(item)
            item.thinkspace_weather_forecaster_assessment_items.each <span class="hljs-keyword">do</span> |assessment_item|
              print_sep <span class="hljs-string">"---AssessmentItem.id:<span class="hljs-subst">#{assessment_item.id}</span> ==&gt;"</span>, item
              print_columns(assessment_item)
            <span class="hljs-keyword">end</span>
          <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="">#</h2>
<h3 id="helpers">Helpers.</h3>
<h2 id="">#</h2></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> compare_dup = options.has_key?(:compare_dup) ? options.delete(:compare_dup) : true</span></p></div></div><div class="code"><div class="wrapper">        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">extract_and_validate_args</span><span class="hljs-params">(args)</span></span>
          args       = [args].flatten.compact.collect {|v| v.strip}
          <span class="hljs-variable">@arg_str</span>   = args.join(<span class="hljs-string">','</span>)
          args       = set_run_class(args)
          args       = set_run_scope(args)
          args       = set_column_names(args)
          args       = set_print_options(args)
          <span class="hljs-variable">@show_help</span> = <span class="hljs-keyword">true</span>  <span class="hljs-keyword">if</span> args.<span class="hljs-keyword">include</span>?(<span class="hljs-string">'help'</span>) || args.<span class="hljs-keyword">include</span>?(<span class="hljs-string">'h'</span>)
          print_run_values
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_run_class</span><span class="hljs-params">(args)</span></span>
          valid = <span class="hljs-constant">Array</span>.new
          klass = <span class="hljs-keyword">nil</span>
          args.each <span class="hljs-keyword">do</span> |arg|
            <span class="hljs-keyword">case</span> arg
            <span class="hljs-keyword">when</span> <span class="hljs-string">'item'</span>                <span class="hljs-keyword">then</span> klass = item_class
            <span class="hljs-keyword">when</span> <span class="hljs-string">'assessment_item'</span>     <span class="hljs-keyword">then</span> klass = assessment_item_class
            <span class="hljs-keyword">when</span> <span class="hljs-string">'station'</span>             <span class="hljs-keyword">then</span> klass = station_class
            <span class="hljs-keyword">when</span> <span class="hljs-string">'assessment'</span>          <span class="hljs-keyword">then</span> klass = assessment_class
            <span class="hljs-keyword">when</span> <span class="hljs-string">'forecast'</span>            <span class="hljs-keyword">then</span> klass = forecast_class
            <span class="hljs-keyword">when</span> <span class="hljs-string">'forecast_day'</span>        <span class="hljs-keyword">then</span> klass = forecast_day_class
            <span class="hljs-keyword">when</span> <span class="hljs-string">'forecast_day_actual'</span> <span class="hljs-keyword">then</span> klass = forecast_day_actual_class
            <span class="hljs-keyword">when</span> <span class="hljs-string">'response'</span>            <span class="hljs-keyword">then</span> klass = response_class
            <span class="hljs-keyword">end</span>
            <span class="hljs-keyword">if</span> klass.present?
              valid.push(arg)
              <span class="hljs-keyword">break</span>
            <span class="hljs-keyword">end</span>
          <span class="hljs-keyword">end</span>
          <span class="hljs-variable">@run_class</span> = klass || item_class
          args - valid
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_run_scope</span><span class="hljs-params">(args)</span></span>
          scope = run_class.all
          valid = <span class="hljs-constant">Array</span>.new
          args.each <span class="hljs-keyword">do</span> |arg|
            key, value = get_arg_values(arg)
            <span class="hljs-keyword">case</span> key
            <span class="hljs-keyword">when</span> <span class="hljs-string">'order'</span>, <span class="hljs-string">'o'</span>
              order       = get_arg_values(arg).last
              order, sort = get_arg_values(order)
              order       = <span class="hljs-string">"<span class="hljs-subst">#{order}</span> <span class="hljs-subst">#{sort}</span>"</span>  <span class="hljs-keyword">if</span> sort.present?
              arg_order.push(order)
              valid.push(arg)
            <span class="hljs-keyword">when</span> <span class="hljs-string">'offset'</span>
              num   = get_arg_number(arg)
              scope = scope.offset(num)
              valid.push(arg)
              arg_scopes.push(<span class="hljs-string">"offset(<span class="hljs-subst">#{num}</span>)"</span>)
            <span class="hljs-keyword">when</span> <span class="hljs-string">'limit'</span>, <span class="hljs-string">'l'</span>
              num   = get_arg_number(arg)
              scope = scope.limit(num)
              valid.push(arg)
              arg_scopes.push(<span class="hljs-string">"limit(<span class="hljs-subst">#{num}</span>)"</span>)
            <span class="hljs-keyword">else</span>
              <span class="hljs-keyword">if</span> is_digits?(arg)
                arg_ids.push(arg)
                valid.push(arg)
              <span class="hljs-keyword">end</span>
            <span class="hljs-keyword">end</span>
          <span class="hljs-keyword">end</span>
          scope      = scope.where(<span class="hljs-symbol">id:</span> arg_ids)  <span class="hljs-keyword">if</span> arg_ids.present?
          scope      = scope.order(arg_order)    <span class="hljs-keyword">if</span> arg_order.present?
          <span class="hljs-variable">@run_scope</span> = scope
          args - valid
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_column_names</span><span class="hljs-params">(args)</span></span>
          class_columns = run_class.column_names
          columns       = <span class="hljs-constant">Array</span>.new
          args.each <span class="hljs-keyword">do</span> |arg|
            <span class="hljs-keyword">case</span> arg
            <span class="hljs-keyword">when</span> <span class="hljs-string">'rm'</span>      <span class="hljs-keyword">then</span> columns.push(<span class="hljs-symbol">:response_metadata</span>)
            <span class="hljs-keyword">when</span> <span class="hljs-string">'pr'</span>      <span class="hljs-keyword">then</span> columns.push(<span class="hljs-symbol">:processing</span>)
            <span class="hljs-keyword">when</span> <span class="hljs-string">'rmpr'</span>    <span class="hljs-keyword">then</span> columns.push(<span class="hljs-symbol">:response_metadata</span>, <span class="hljs-symbol">:processing</span>)
            <span class="hljs-keyword">when</span> <span class="hljs-string">'p'</span>       <span class="hljs-keyword">then</span> columns.push(<span class="hljs-symbol">:presentation</span>)
            <span class="hljs-keyword">when</span> <span class="hljs-string">'ht'</span>      <span class="hljs-keyword">then</span> columns.push(<span class="hljs-symbol">:help_tip</span>)
            <span class="hljs-keyword">when</span> <span class="hljs-string">'ih'</span>      <span class="hljs-keyword">then</span> columns.push(<span class="hljs-symbol">:item_header</span>)
            <span class="hljs-keyword">when</span> <span class="hljs-string">'v'</span>       <span class="hljs-keyword">then</span> columns.push(<span class="hljs-symbol">:value</span>)
            <span class="hljs-keyword">else</span>
              columns.push(arg.to_sym) <span class="hljs-keyword">if</span> class_columns.<span class="hljs-keyword">include</span>?(arg)
            <span class="hljs-keyword">end</span>
          <span class="hljs-keyword">end</span>
          <span class="hljs-variable">@column_names</span> = columns.uniq
          args - class_columns
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_print_options</span><span class="hljs-params">(args)</span></span>
          valid = <span class="hljs-constant">Array</span>.new
          args.each <span class="hljs-keyword">do</span> |arg|
            <span class="hljs-keyword">case</span> arg
            <span class="hljs-keyword">when</span> <span class="hljs-string">'dup'</span>
              <span class="hljs-variable">@compare_dup</span> = <span class="hljs-keyword">true</span>
              valid.push(arg)
            <span class="hljs-keyword">when</span> <span class="hljs-string">'ap'</span>
              <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.respond_to?(<span class="hljs-symbol">:ap</span>, <span class="hljs-keyword">true</span>)
                <span class="hljs-variable">@print_method</span> = <span class="hljs-symbol">:ap</span>
              <span class="hljs-keyword">else</span>
                puts <span class="hljs-string">"Warning: awesome_print gem is not available.  Defaulting to 'pp'."</span>
              <span class="hljs-keyword">end</span>
              valid.push(arg)
            <span class="hljs-keyword">when</span> <span class="hljs-string">'plain'</span>, <span class="hljs-string">'no_color'</span>, <span class="hljs-string">'no-color'</span>
              <span class="hljs-variable">@ap_options</span>[<span class="hljs-symbol">:plain</span>] = <span class="hljs-keyword">true</span>
              valid.push(arg)
            <span class="hljs-keyword">when</span> <span class="hljs-string">'index'</span>
              <span class="hljs-variable">@ap_options</span>[<span class="hljs-symbol">:index</span>] = <span class="hljs-keyword">true</span>
              valid.push(arg)
            <span class="hljs-keyword">when</span> <span class="hljs-string">'sort_keys'</span>, <span class="hljs-string">'sort-keys'</span>, <span class="hljs-string">'sk'</span>
              <span class="hljs-variable">@ap_options</span>[<span class="hljs-symbol">:sort_keys</span>] = <span class="hljs-keyword">true</span>
              valid.push(arg)
            <span class="hljs-keyword">when</span> <span class="hljs-string">'no_sort_keys'</span>, <span class="hljs-string">'no-sort-keys'</span>, <span class="hljs-string">'nsk'</span>
              <span class="hljs-variable">@ap_options</span>[<span class="hljs-symbol">:sort_keys</span>] = <span class="hljs-keyword">false</span>
              valid.push(arg)
            <span class="hljs-keyword">else</span>
              key, value = get_arg_values(arg)
              <span class="hljs-keyword">if</span> key == <span class="hljs-string">'indent'</span>
                <span class="hljs-variable">@ap_options</span>[<span class="hljs-symbol">:indent</span>] = get_arg_number(arg)
                valid.push(arg)
              <span class="hljs-keyword">end</span>
            <span class="hljs-keyword">end</span>
          <span class="hljs-keyword">end</span>
          <span class="hljs-keyword">if</span> print_method == <span class="hljs-symbol">:ap</span>
            ap_options[<span class="hljs-symbol">:sort_keys</span>] = <span class="hljs-variable">@ap_sort_keys</span>  <span class="hljs-keyword">unless</span> ap_options.has_key?(<span class="hljs-symbol">:sort_keys</span>)
          <span class="hljs-keyword">end</span>
          args - valid
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_arg_values</span><span class="hljs-params">(arg)</span>;</span> arg.split(<span class="hljs-string">':'</span>,<span class="hljs-number">2</span>); <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_arg_number</span><span class="hljs-params">(arg)</span></span>
          key, value = get_arg_values(arg)
          stop_run <span class="hljs-string">"Arg <span class="hljs-subst">#{arg.inspect}</span> must have a number value not <span class="hljs-subst">#{value.inspect}</span>."</span> <span class="hljs-keyword">unless</span> is_digits?(value)
          value.to_i
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_digits?</span><span class="hljs-params">(arg)</span></span>
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span> <span class="hljs-keyword">if</span> arg.blank?
          arg.match(<span class="hljs-regexp">/^\d+$/</span>)
        <span class="hljs-keyword">end</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="">#</h2>
<h3 id="print-helpers">Print Helpers.</h3>
<h2 id="">#</h2></div></div><div class="code"><div class="wrapper">        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_run_values</span></span>
          puts <span class="hljs-string">"\nRun values:"</span>
          print_value <span class="hljs-string">'Class'</span>,        run_class.name
          print_value <span class="hljs-string">'Arg string'</span>,   (arg_str || <span class="hljs-string">''</span>).inspect
          print_value <span class="hljs-string">'Ids'</span>,          arg_ids
          print_value <span class="hljs-string">'Order'</span>,        arg_order
          print_value <span class="hljs-string">'Columns'</span>,      (column_names || []).map{|n| n.to_s}
          print_value <span class="hljs-string">'ap options'</span>,   ap_options.inspect  <span class="hljs-keyword">if</span> print_method == <span class="hljs-symbol">:ap</span>
          print_value <span class="hljs-string">'Scopes'</span>,       arg_scopes
          <span class="hljs-keyword">if</span> show_help
            print_help
            stop_run
          <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_value</span><span class="hljs-params">(text, values, sub_text=<span class="hljs-string">''</span>)</span></span>
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> values.blank?
          len = <span class="hljs-number">20</span>
          puts <span class="hljs-string">"   <span class="hljs-subst">#{text}</span><span class="hljs-subst">#{sub_text}</span>"</span>.ljust(len) + <span class="hljs-string">": <span class="hljs-subst">#{values}</span>"</span>
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_item_text</span><span class="hljs-params">(item)</span></span>
          <span class="hljs-string">"<span class="hljs-subst">#{item.<span class="hljs-keyword">class</span>.name.demodulize}</span>.id:<span class="hljs-subst">#{item.id}</span>"</span>
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_columns</span><span class="hljs-params">(item, text=<span class="hljs-string">''</span>)</span></span>
          <span class="hljs-keyword">if</span> column_names.blank?
            print_item item
          <span class="hljs-keyword">else</span>
            column_names.each <span class="hljs-keyword">do</span> |col|
              print_column_header(col, text)
              print_item item[col]
            <span class="hljs-keyword">end</span>
          <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_column_header</span><span class="hljs-params">(col, text=<span class="hljs-string">''</span>)</span></span>
          len  = <span class="hljs-number">25</span>
          text = text.present? ? <span class="hljs-string">" --<span class="hljs-subst">#{text}</span>"</span>.ljust(len, <span class="hljs-string">'-'</span>) <span class="hljs-symbol">:</span> <span class="hljs-string">'-'</span>.ljust(len, <span class="hljs-string">'-'</span>)
          puts text + <span class="hljs-string">"&gt; <span class="hljs-subst">#{col}</span>:"</span>
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_item</span><span class="hljs-params">(object)</span></span>
          print_method == <span class="hljs-symbol">:ap</span> ? ap(object, ap_options) <span class="hljs-symbol">:</span> pp(object)
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_sep</span><span class="hljs-params">(description, item)</span></span>
          sep = <span class="hljs-string">"<span class="hljs-subst">#{description}</span> <span class="hljs-subst">#{get_item_text(item)}</span> "</span> + <span class="hljs-string">'-'</span> * <span class="hljs-number">50</span>
          puts <span class="hljs-string">"\n&lt;"</span> + sep + <span class="hljs-string">"&gt;\n"</span>
          print_item_header(item)
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_item_header</span><span class="hljs-params">(item)</span></span>
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">unless</span> item.respond_to?(<span class="hljs-symbol">:title</span>)
          puts <span class="hljs-string">"title: <span class="hljs-subst">#{item.title.inspect}</span>"</span>
          puts <span class="hljs-string">"\n"</span>
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pad</span>;</span> <span class="hljs-variable">@_pad</span> ||= <span class="hljs-string">' '</span> * indent; <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">stop_run</span><span class="hljs-params">(message=<span class="hljs-string">''</span>)</span></span>
          puts <span class="hljs-string">"\n"</span>
          puts <span class="hljs-string">"Run stopped. "</span> + message
          exit
        <span class="hljs-keyword">end</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_help</span></span>
          help = &lt;&lt;<span class="hljs-constant">HELP</span>
<span class="hljs-constant">Run</span> <span class="hljs-symbol">help:</span>
  rake task <span class="hljs-symbol">options:</span>
    * options can be <span class="hljs-keyword">in</span> any order <span class="hljs-keyword">in</span> the argument string
    [help|h]          print help
    [table]           name of table to use
    scope-<span class="hljs-symbol">related:</span>     
      [<span class="hljs-comment">#,#,...]         record ids for the main run class e.g item, assessment_item</span>
      [<span class="hljs-symbol">limit:</span><span class="hljs-comment">#|l:#]     limit records to #</span>
      [<span class="hljs-symbol">offset:</span><span class="hljs-comment">#]        offset records starting at #</span>
      [<span class="hljs-symbol">order:</span>col|<span class="hljs-symbol">o:</span>col] order by column; each column value can add a sort order [asc|desc] e.g. <span class="hljs-symbol">order:</span><span class="hljs-symbol">id:</span>desc,<span class="hljs-symbol">order:</span><span class="hljs-symbol">title:</span>asc
    column-<span class="hljs-symbol">related:</span>
      [col1,col2,...]   string column name to print
      [rm]              <span class="hljs-keyword">alias</span> <span class="hljs-symbol">for:</span> response_metadata
      [pr]              <span class="hljs-keyword">alias</span> <span class="hljs-symbol">for:</span> processing
      [rmpr]            <span class="hljs-keyword">alias</span> <span class="hljs-symbol">for:</span> [response_metadata, processing]
      [ht]              <span class="hljs-symbol">alias_for:</span> help_tip
      [p]               <span class="hljs-symbol">alias_for:</span> presentation
      [ih]              <span class="hljs-symbol">alias_for:</span> item_header
      [v]               <span class="hljs-symbol">alias_for:</span> value
    print-<span class="hljs-symbol">related:</span>
      [dup]             duplicate item data on <span class="hljs-string">'compare'</span> task (default <span class="hljs-keyword">false</span>)
      [ap]              use awesome_print (default is pp); ignored <span class="hljs-keyword">if</span> awesome_print gem <span class="hljs-keyword">not</span> available
      <span class="hljs-symbol">ap_options:</span>
        [index]                          show array indexes
        [<span class="hljs-symbol">indent:</span><span class="hljs-comment">#]                       spaces to indent</span>
        [plain|no_color|no-color]        <span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> use colors
        [sort_keys|sort-keys|sk]         sort column name <span class="hljs-keyword">and</span>/<span class="hljs-keyword">or</span> nested hash keys
        [no_sort_keys|no-sort-keys|nsk]  <span class="hljs-keyword">do</span> <span class="hljs-constant">NOT</span> sort column name <span class="hljs-keyword">and</span>/<span class="hljs-keyword">or</span> nested hash keys

  <span class="hljs-constant">Examples</span><span class="hljs-symbol">:</span>
    rake <span class="hljs-symbol">thinkspace:</span><span class="hljs-symbol">weather_forecaster:</span><span class="hljs-symbol">print_items:</span>all                    <span class="hljs-comment">#=&gt; print all item columns</span>
    rake <span class="hljs-symbol">thinkspace:</span><span class="hljs-symbol">weather_forecaster:</span><span class="hljs-symbol">print_items:</span>all[ap]                <span class="hljs-comment">#=&gt; use awesome_print gem if available</span>
    rake <span class="hljs-symbol">thinkspace:</span><span class="hljs-symbol">weather_forecaster:</span><span class="hljs-symbol">print_items:</span>columns[col1,col2...]  <span class="hljs-comment">#=&gt; print columns from item records</span>
    rake <span class="hljs-symbol">thinkspace:</span><span class="hljs-symbol">weather_forecaster:</span><span class="hljs-symbol">print_items:</span>all[assessment_item]   <span class="hljs-comment">#=&gt; print all assessment_item columns</span>
    rake <span class="hljs-symbol">thinkspace:</span><span class="hljs-symbol">weather_forecaster:</span><span class="hljs-symbol">print_items:</span>compare[col1,col2,...] <span class="hljs-comment">#=&gt; print item column(s) and associated assessment_items column(s)</span>
    rake <span class="hljs-symbol">thinkspace:</span><span class="hljs-symbol">weather_forecaster:</span><span class="hljs-symbol">print_items:</span>columns[p,<span class="hljs-number">1</span>]           <span class="hljs-comment">#=&gt; print item presentation column for item.id 1</span>
    rake <span class="hljs-symbol">thinkspace:</span><span class="hljs-symbol">weather_forecaster:</span><span class="hljs-symbol">print_items:</span>compare[p,<span class="hljs-symbol">l:</span><span class="hljs-number">3</span>,<span class="hljs-symbol">o:</span><span class="hljs-number">5</span>,dup] <span class="hljs-comment">#=&gt; compare presentation columns starting with record 5 for 3 records; duplicate item data</span>
<span class="hljs-constant">HELP</span>
          puts help
        <span class="hljs-keyword">end</span>



      <span class="hljs-keyword">end</span>

    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></div></div></div></div></body></html>
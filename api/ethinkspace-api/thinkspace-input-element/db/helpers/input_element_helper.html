<!DOCTYPE html><html lang="en"><head><title>thinkspace-input-element/db/helpers/input_element_helper</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../"><meta name="groc-document-path" content="thinkspace-input-element/db/helpers/input_element_helper"><meta name="groc-project-path" content="thinkspace-input-element/db/helpers/input_element_helper.rb"><meta name="groc-branch-path" content="development"><meta name="groc-github-url" content="https://github.com/sixthedge/ethinkspace-api"><link rel="stylesheet" type="text/css" media="all" href="../../../assets/style.css"><script type="text/javascript" src="../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/sixthedge/ethinkspace-api/blob/development/thinkspace-input-element/db/helpers/input_element_helper.rb">thinkspace-input-element/db/helpers/input_element_helper.rb</a></div></div><div id="document"><a href="/" class="lodestar-link">Back to Guides</a><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">require</span> <span class="hljs-string">'nokogiri'</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">input_element_html_preprocessors</span><span class="hljs-params">(*args)</span></span>
  options   = args.extract_options!
  attribute = options[<span class="hljs-symbol">:attribute</span>] || <span class="hljs-string">'html_content'</span>
  paths     = <span class="hljs-constant">Array</span>.new
  paths.push [<span class="hljs-symbol">:input_element</span>, <span class="hljs-symbol">:preprocessors</span>, <span class="hljs-symbol">:responses</span>]      <span class="hljs-keyword">if</span> options[<span class="hljs-symbol">:responses</span>] == <span class="hljs-keyword">true</span>
  paths.push [<span class="hljs-symbol">:input_element</span>, <span class="hljs-symbol">:preprocessors</span>, <span class="hljs-symbol">:carry_forward</span>]  <span class="hljs-keyword">if</span> options[<span class="hljs-symbol">:carry_forward</span>] == <span class="hljs-keyword">true</span>
  [{<span class="hljs-symbol">attribute:</span> attribute, <span class="hljs-symbol">paths:</span> paths}]
<span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_input_elements</span><span class="hljs-params">(*args)</span></span>
  options        = args.extract_options!
  componentable  = args.shift
  content_column = args.shift
  content        = componentable.send content_column
  input_element_names(content).each <span class="hljs-keyword">do</span> |hash|
    element               = <span class="hljs-variable">@seed</span>.new_model(<span class="hljs-symbol">:input_element</span>, <span class="hljs-symbol">:element</span>)
    element.name          = hash[<span class="hljs-symbol">:name</span>]
    element.element_type  = hash[<span class="hljs-symbol">:element_type</span>]
    element.componentable = componentable
    <span class="hljs-variable">@seed</span>.create_error(element) <span class="hljs-keyword">unless</span> element.save
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">input_element_names</span><span class="hljs-params">(content)</span></span>
  input_names = []
  radio_names = []
  html        = <span class="hljs-constant">Nokogiri::HTML</span>.fragment(content)
  inputs      = html.css(<span class="hljs-string">'input'</span>)
  inputs.each <span class="hljs-keyword">do</span> |input|
    type = input[<span class="hljs-string">'type'</span>]
    name = input[<span class="hljs-string">'name'</span>]
    <span class="hljs-keyword">if</span> type == <span class="hljs-string">'radio'</span>
      <span class="hljs-keyword">next</span> <span class="hljs-keyword">if</span> radio_names.<span class="hljs-keyword">include</span>?(name) <span class="hljs-comment"># radio will have dup names (only add first one)</span>
      radio_names.push(name)
    <span class="hljs-keyword">end</span>
    input_names.push({<span class="hljs-symbol">name:</span> name, <span class="hljs-symbol">element_type:</span> type})
  <span class="hljs-keyword">end</span>
  inputs      = html.css(<span class="hljs-string">'textarea'</span>)
  inputs.each <span class="hljs-keyword">do</span> |input|
    input_names.push({<span class="hljs-symbol">name:</span> input[<span class="hljs-string">'name'</span>], <span class="hljs-symbol">element_type:</span> <span class="hljs-string">'textarea'</span>})
  <span class="hljs-keyword">end</span>
  input_names
<span class="hljs-keyword">end</span></div></div></div></div></body></html>